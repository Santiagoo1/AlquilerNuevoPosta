@page "/Alquilar/{Id:int}"
@using Alquiler.BD.Data.Entidades
@using AlquilerNuevoPosta.Client.Servicios
@inject IHttpService http
@inject NavigationManager navigationManager



<html>

    <div class="producto">
    <div class= "foto">
        <img class="imagenproducto" src="@producto.foto" />
    </div>

    <div class="card">

                <div class=" card-body">
            <h5 class="card-title mb-3">
                <b>@producto.NombreProducto</b>
            </h5>    
                
            <p class="card-text">
                <b>Precio:$@producto.PrecioProducto.ToString()</b>
                <br />
               <b> Detalle:@producto.DetallesProducto</b>
            </p>
            <div class="card-footer">
                  <div class="botonalquiler">
                <button type="submit" @onclick="(() =>{Eliminar();})" class="btn btn-primary" >Alquilar</button>
                 </div>

            </div>
        </div>
    </div>
    </div>

    <Confirmacion @ref="confirmacion"
              verCancelar="true"
              verOk="true"
              textOk="Ok"
              Titulo="Borrar especialidad"
              onCancel="Cancelar"
              onConfirm="Borrar">
              <div>
                  Está por pagar @producto.PrecioProducto para comprar @producto.NombreProducto
                  <br />
                  ¿Está seguro que desea continuar?
              </div>
</Confirmacion>


 </html>

@code {
    [Parameter] public int Id { get; set; }
    private ProductoPublicado producto = new ProductoPublicado();

    Confirmacion confirmacion;

    List<ProductoPublicado> productos;

    protected override async Task OnParametersSetAsync()
    {

        var respuesta = await http.Get<ProductoPublicado>($"api/Productos/{Id}");
        if(respuesta.Error)
        {
            var body = respuesta.HttpResponseMessage;
        }
        else
        {
            producto = respuesta.Respuesta;
        }
    }

    private async void Grabar()


    {

        List<Estado> estados;

        int Estadoid = 0;


        var respuesta = await http.Post<ProductoPublicado>($"api/ProductoAlquilado",producto);
        if(respuesta.Error)
        {
            var body = respuesta.HttpResponseMessage;
        }     

    }



    public async void  PutAlquilado(ProductoPublicado productoactual)
    {
        productoactual.Alquilado = true;

        var respuesta = await http.Put<ProductoPublicado>($"api/Productos/{productoactual.Id}", productoactual);
        if (respuesta.Error)
        {
            var body = respuesta.HttpResponseMessage;
        }
        navigationManager.NavigateTo("/Productos2");

    }
    private void Cancelar()
    {
        confirmacion.Ocultar();
        navigationManager.NavigateTo("/Logiado");
    }

    private void Borrar()
    {
        PutAlquilado(producto);
        navigationManager.NavigateTo("/Productos2");
    }

    private void Eliminar()
    {
        
        confirmacion.Ver();
    }
}
